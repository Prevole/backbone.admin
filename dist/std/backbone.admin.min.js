/*!
 * Backbone.Admin v0.0.1
 * Copyright (c) 2013 Laurent Pr√©vost (prevole) <prevole@prevole.ch>
 * Distributed under MIT license
 * https://github.com/prevole/backbone.admin
 */
var Admin,__hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};Backbone.Admin=Admin=function(e,t,n,r){var i,s,o,u,a,f;return Admin={version:"0.0.1"},i=!1,a=!1,f=new RegExp(/[a-z]+(:[a-z]+)*/),o=new t.EventAggregator,s=null,Admin.Module=function(){function t(e){if(this.name===void 0)throw new Error("The name of the module must be defined");if(this.routableActions===void 0)throw new Error("At least one routable action must be defined")}var e;return t.prototype.getRoutableActions=function(){return this.routableActions},t.prototype.getActions=function(){if(this.actions===void 0)throw new Error("No action are defined");return this.actions},e=function(e){},t}(),Admin.CrudModule=function(e){function n(e){n.__super__.constructor.call(this,e);if(this.collection===void 0)throw new Error("The collection must be specified");this.model===void 0&&this.collection.prototype.model!==void 0&&(this.model=this.collection.prototype.model);if(this.model===void 0)throw new Error("The model must be specified")}var t;return __extends(n,e),n.prototype.getRoutableActions=function(){return this.routableActions},n.prototype.getActions=function(){if(this.actions===void 0)throw new Error("No action are defined");return this.actions},t=function(e){},n}(Admin.Module),u={info:"datagrid.info",pager:{first:"datagrid.pager.first",last:"datagrid.pager.last",next:"datagrid.pager.next",previous:"datagrid.pager.previous",filler:"datagrid.pager.filler"}},Admin.setupDefaultI18nBindings=function(e){return u=n.defaults(e.i18n||{},u)},Admin.StatedCollection=e.Collection.extend({initialize:function(e){return this.current=n.defaults({},{page:1,ipp:2,quickSearch:"",sorting:{}})},sync:function(e,t,i){var s,o,u=this;return o=i.success,i.success=function(e,t){return o(e,t),u.trigger("fetched")},s=n.extend({},{jsonpCallback:"callback",timeout:25e3,cache:!1,type:"GET",dataType:"json",processData:!1,url:this.url,headers:{"X-Grid-Parameters":JSON.stringify(this.current)}},i),r.ajax(s)},parse:function(e,t){var n;return n=e.info,this.current.records=n.records,this.current.pages=n.pages,this.current.filteredRecords=n.filteredRecords,this.current.filteredPages=n.filteredPages,this.current.from=(this.current.page-1)*this.current.ipp+1,this.current.to=this.current.from+this.current.ipp-1,this.current.to>this.current.filteredRecords&&(this.current.to=this.current.filteredRecords),this.current.page>this.current.filteredPages&&this.current.filteredPages>0&&(this.current.page=this.current.filteredPages,this.fetch()),e.data},refresh:function(){return this.reset(),this.fetch()},getInfo:function(){return this.current},updateInfo:function(e){return this.current=n.defaults(e,this.current),this.fetch()}}),Admin.instanciateModule=function(e){var t;if(i)throw new Error("Application already started, it is not possible to register more modules.");return t=new ModuleController(e),mainController.registerModule(t)},Admin.init=function(e){return a=!0,e=e||{},e.authorizator?s=new e.authorizator:s=new Admin.Authorizator},Admin.start=function(n){var r,s,u,f,l;a||Admin.init(),i=!0;if(n===void 0)throw new Error("No option defined when some are required.");return n.mainRegion===void 0?s=Admin.MainRegion:s=n.mainRegion,n.navigationView!=null?u=n.navigationView:u=Admin.NavigationView,f=new e.Router,l=function(e){return f.route(e,e,function(){return alert(e)}),f.navigate(e,{trigger:!0})},r=new t.Application,r.on("initialize:after",function(){return e.history.start({pushState:!0})}),o.on("changeView",function(e){return r.mainRegion.show(e)}),r.addInitializer(function(){var e;return e=new u,e.on("navigate:switchModule",l),this.addRegions({mainRegion:s})}),r.start()},Admin.can=function(e,t){return s.can(e,t)},Admin.cannot=function(e,t){return s.cannot(e,t)},Admin}(Backbone,Backbone.Marionette,_,$||window.jQuery||window.Zepto||window.ender);