/*
 * Backbone.Admin - v0.0.1
 * Copyright (c) 2013-04-04 Laurent Prevost (prevole) <prevole@prevole.ch>
 * Distributed under MIT license
 * https://github.com/prevole/backbone.admin
 */
(function(){var t={}.hasOwnProperty,o=function(o,i){function e(){this.constructor=o}for(var r in i)t.call(i,r)&&(o[r]=i[r]);return e.prototype=i.prototype,o.prototype=new e,o.__super__=i.prototype,o};window.Backbone.Admin=window.Admin=function(Backbone,t,i,e){var r,n,u,s,a;return u={version:"0.0.1"},s=null,r=function(){function t(t,o,i,e){if(this.isRoutable=t,this.module=o,void 0===this.module)throw Error("The module must be defined");this.moduleName=this.module.name,void 0!==i&&(this.actionName=i),void 0!==e&&(this.options=e)}return t.prototype.module=null,t.prototype.actionName="main",t.prototype.options={},t.prototype.isRoutable=!1,t.prototype.route=function(){var t,o,i,e;if(void 0!==this.module.routeActions[this.actionName]){o=this.module.route(this.actionName),e=this.options;for(t in e)i=e[t],o=o.replace(":"+t,i);return o}},t}(),n=new(function(){function t(){}return t.prototype.action=function(t,o,i){return new r(!1,t,o,i)},t.prototype.routeAction=function(t,o,i){return new r(!0,t,o,i)},t.prototype.outsideAction=function(t,o,i,e){return t?this.routeAction(o,i,e):this.action(o,i,e)},t}()),u.ApplicationController=function(){function o(t){var o=this;i.extend(this,Backbone.Events),t=i.defaults(t||{},{router:Backbone.Router}),this.router=i.isBoolean(t.router)&&t.router?new Backbone.Router:i.isFunction(t.router)?new t.router(t):t.router,this.on("action:outside:route",function(t,i){return s.call(o,t,!0,i)}),this.on("action:outside:noroute",function(t,i){return s.call(o,t,!1,i)}),this.on("action:done",function(t){return r.call(o,t)}),i.isNull(this.router)||this.listenTo(this.router,"route",function(t,i){return a.call(o,t,i)})}var e,r,s,a;return o.prototype.initializers=new t.Callbacks,o.prototype.triggerMethod=t.triggerMethod,o.prototype.modules={},o.prototype.regionNames=[],o.prototype.router=null,o.prototype.started=!1,o.prototype.addInitializer=function(t){return this.initializers.add(t)},o.prototype.start=function(t){return this.started?console.log("Application controller already started."):(this.triggerMethod("before:start",t),this.initializers.run(t,this),(!i.isNull(this.router)||Backbone.history.started)&&Backbone.history.start({pushState:!0}),this.triggerMethod("after:start",t))},s=function(t,o,i){var r,u,s;return u=t.split(":"),s=this.modules[u[0]],r=void 0===u[1]?"main":u[1],void 0!==s?e.call(this,n.outsideAction(o,s,r,i)):void 0},a=function(t,o){var r,u,s,a,l,c,d,h,p,f;if(u=t.split(":"),a=this.modules[u[0]],r=void 0===u[1]?"main":u[1],void 0!==a){if(l={},h=a.route(r),void 0!==h&&(d=h.match(/(\(\?)?:\w+/g),!i.isNull(d)))for(s=p=0,f=d.length-1;f>=0?f>=p:p>=f;s=f>=0?++p:--p)c=d[s].slice(1),l[c]=o[s],o[s]=null;return l._params=i.filter(o,function(t){return!i.isNull(t)}),e.call(this,n.action(a,r,l))}},e=function(t){var o,e,r,n,u;if(e=t.module[t.actionName](t.options),!i.isNull(e)){for(u=i.keys(e),r=0,n=u.length;n>r;r++)o=u[r],void 0!==this[o]&&this[o].show(e[o]);return this.trigger("action:done",t)}},r=function(t){return!i.isNull(this.router)&&t.isRoutable?this.router.navigate(t.route()):void 0},o.prototype.registerModule=function(t){var o,r,n,s=this;if(void 0===t)throw Error("The module cannot be undefined");if(!(t instanceof u.Module))throw Error("The module must be from Admin.Module type");if(void 0!==this.modules[t.name])throw Error("The module is already registered");if(this.modules[t.name]=t,!i.isNull(this.router)){n=t.routes();for(o in n)r=n[o],this.router.route(r,""+t.name+":"+o)}return this.listenTo(t,"action:module",function(t){return e.call(s,t)})},o.prototype.registerRegion=function(t,o){if(void 0!==this[t])throw Error("The region "+t+" is already registered");return this[t]=o,this.regionNames.push(t)},o}(),u.NavigationView=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return o(i,t),i.prototype.events={"click [data-action]":"action"},i.prototype.initialize=function(t){if(void 0===this.applicationController){if(void 0===t.applicationController)throw Error("An application controller must be defined");return this.applicationController=t.applicationController}},i.prototype.action=function(t){return t.preventDefault(),this.applicationController.trigger("action:outside:route",e(t.target).attr("data-action"))},i}(t.View),u.Module=t.Controller.extend({initialize:function(){if(void 0===this.name)throw Error("The name of the module must be defined");if(void 0===this.routeActions)throw Error("At least one route action must be defined");return void 0===this.basePath&&(this.basePath=""+this.name.replace(/:/g,"/")),this.basePath=i.str.endsWith(this.basePath,"/")?this.basePath:""+this.basePath+"/"},routes:function(){var t,o=this;return t=function(t,i,e){return t[e]=o.route(e),t},i.chain(i.reduce(this.routeActions,t,{})).pairs().sortBy(1).object().value()},route:function(t){var o;return o=this.routeActions[t],""===o?i.str.rtrim(this.basePath,"/"):""+this.basePath+i.str.ltrim(o,"/")},routableAction:function(t,o,i){return this.trigger("action:module",n.routeAction(this,t,o),i)},action:function(t,o){return this.trigger("action:module",n.action(this,t,o))}}),u.CrudModule=u.Module.extend({initialize:function(t){if(this["super"](t),void 0===this.collection)throw Error("The collection must be specified");if(void 0===this.model&&void 0!==this.collection.prototype.model&&(this.model=this.collection.prototype.model),void 0===this.model)throw Error("The model must be specified")}}),u.MainRegion=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return o(i,t),i.prototype.el=".content",i}(t.Region),a={info:"datagrid.info",pager:{first:"datagrid.pager.first",last:"datagrid.pager.last",next:"datagrid.pager.next",previous:"datagrid.pager.previous",filler:"datagrid.pager.filler"}},u.setupDefaultI18nBindings=function(t){return a=i.defaults(t.i18n||{},a)},u.can=function(t,o){return s.can(t,o)},u.cannot=function(t,o){return s.cannot(t,o)},u}(Backbone,Backbone.Marionette,_,$||window.jQuery||window.Zepto||window.ender)}).call(this);