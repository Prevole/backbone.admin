/*
 * Backbone.Admin - v0.0.3
 * Copyright (c) 2013-04-15 Laurent Prevost (prevole) <prevole@prevole.ch>
 * Distributed under MIT license
 * https://github.com/prevole/backbone.admin
 */
(function(){var t={}.hasOwnProperty,e=function(e,o){function i(){this.constructor=e}for(var r in o)t.call(o,r)&&(e[r]=o[r]);return i.prototype=o.prototype,e.prototype=new i,e.__super__=o.prototype,e};window.Backbone.Admin=window.Admin=function(Backbone,t,o,i){var r,n,u,s,a;return u={version:"0.0.1"},s=null,o.mixin({view:function(t){return o.object(["view"],[t])},model:function(t,e){if(void 0===e)throw Error("Action must be defined");if(void 0===e.options)throw Error("Options in action must be defined");return void 0===e.options.model?t.get(e.options.id):e.options.model}}),r=function(){function t(t,e,o,i){if(this.isRoutable=t,this.module=e,void 0===this.module)throw Error("The module must be defined");this.moduleName=this.module.name,void 0!==o&&(this.name=o),void 0!==i&&(this.options=i)}return t.prototype.module=null,t.prototype.name="main",t.prototype.options={},t.prototype.isRoutable=!1,t.prototype.updatedRegions={},t.prototype.route=function(){var t,e,o,i;if(void 0!==this.module.routeActions[this.name]){e=this.module.route(this.name),i=this.options;for(t in i)o=i[t],e=e.replace(":"+t,o);return e}},t}(),n=new(function(){function t(){}return t.prototype.action=function(t,e,o){return new r(!1,t,e,o)},t.prototype.routeAction=function(t,e,o){return new r(!0,t,e,o)},t.prototype.outsideAction=function(t,e,o,i){return t?this.routeAction(e,o,i):this.action(e,o,i)},t}()),u.ApplicationController=function(){function e(t){var e=this;o.extend(this,Backbone.Events),t=o.defaults(t||{},{router:Backbone.Router}),this.router=o.isBoolean(t.router)&&t.router?new Backbone.Router:o.isFunction(t.router)?new t.router(t):t.router,this.on("action:outside:route",function(t,o){return s.call(e,t,!0,o)}),this.on("action:outside:noroute",function(t,o){return s.call(e,t,!1,o)}),o.isNull(this.router)||this.listenTo(this.router,"route",function(t,o){return a.call(e,t,o)})}var i,r,s,a;return e.prototype.initializers=new t.Callbacks,e.prototype.triggerMethod=t.triggerMethod,e.prototype.modules={},e.prototype.regionNames=[],e.prototype.router=null,e.prototype.started=!1,e.prototype.addInitializer=function(t){return this.initializers.add(t)},e.prototype.start=function(t){return this.started?console.log("Application controller already started."):(this.triggerMethod("before:start",t),this.initializers.run(t,this),(!o.isNull(this.router)||Backbone.history.started)&&Backbone.history.start({pushState:!0}),this.triggerMethod("after:start",t))},s=function(t,e,o){var r,u,s;return u=t.split(":"),s=this.modules[u[0]],r=void 0===u[1]?"main":u[1],void 0!==s?i.call(this,n.outsideAction(e,s,r,o)):void 0},a=function(t,e){var r,u,s,a,l,c,d,h,p,f;if(u=t.split(":"),a=this.modules[u[0]],r=void 0===u[1]?"main":u[1],void 0!==a){if(l={},h=a.route(r),void 0!==h&&(d=h.match(/(\(\?)?:\w+/g),!o.isNull(d)))for(s=p=0,f=d.length-1;f>=0?f>=p:p>=f;s=f>=0?++p:--p)c=d[s].slice(1),l[c]=e[s],e[s]=null;return l._params=o.filter(e,function(t){return!o.isNull(t)}),i.call(this,n.action(a,r,l))}},i=function(t){return void 0!==t&&void 0!==t.module?t.module.trigger("action:execute",t):void 0},r=function(t){var e,i,r,n;if(!o.isNull(t.updatedRegions)){for(n=o.keys(t.updatedRegions),i=0,r=n.length;r>i;i++)e=n[i],void 0!==this[e]&&this[e].show(t.updatedRegions[e].view);if(!o.isNull(this.router)&&t.isRoutable)return this.router.navigate(t.route())}},e.prototype.registerModule=function(t){var e,n,s,a=this;if(void 0===t)throw Error("The module cannot be undefined");if(!(t instanceof u.Module))throw Error("The module must be from Admin.Module type");if(void 0!==this.modules[t.name])throw Error("The module is already registered");if(this.modules[t.name]=t,!o.isNull(this.router)){s=t.routes();for(e in s)n=s[e],this.router.route(n,""+t.name+":"+e)}return this.listenTo(t,"action:module",function(t){return i.call(a,t)}),this.listenTo(t,"action:executed",function(t){return r.call(a,t)})},e.prototype.registerRegion=function(t,e){if(void 0!==this[t])throw Error("The region "+t+" is already registered");return this[t]=e,this.regionNames.push(t)},e}(),u.NavigationView=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.events={"click [data-action]":"action"},o.prototype.initialize=function(t){if(void 0===this.applicationController){if(void 0===t.applicationController)throw Error("An application controller must be defined");return this.applicationController=t.applicationController}},o.prototype.action=function(t){return t.preventDefault(),this.applicationController.trigger("action:outside:route",i(t.target).attr("data-action"))},o}(t.View),u.Module=t.Controller.extend({constructor:function(){var e;if(void 0===this.name)throw Error("The name of the module must be defined");if(void 0===this.routeActions)throw Error("At least one route action must be defined");return e=Array.prototype.slice.apply(arguments),t.Controller.prototype.constructor.apply(this,e),void 0===this.basePath&&(this.basePath=""+this.name.replace(/:/g,"/")),this.basePath=o.str.endsWith(this.basePath,"/")?this.basePath:""+this.basePath+"/",this.on("action:route",function(t,e,o){return this.trigger("action:module",n.routeAction(this,t,e),o)}),this.on("action:noroute",function(t,e){return this.trigger("action:module",n.action(this,t,e))}),this.on("action:execute",function(t){return this.triggerMethod(t.name,t),this.trigger("action:executed",t)})},routes:function(){var t,e=this;return t=function(t,o,i){return t[i]=e.route(i),t},o.chain(o.reduce(this.routeActions,t,{})).pairs().sortBy(1).object().value()},route:function(t){var e;return e=this.routeActions[t],""===e?o.str.rtrim(this.basePath,"/"):""+this.basePath+o.str.ltrim(e,"/")}}),u.CrudModule=u.Module.extend({constructor:function(){var t;if(t=Array.prototype.slice.apply(arguments),u.Module.prototype.constructor.apply(this,t),void 0===this.collection)throw Error("The collection must be specified");if(o.isFunction(this.collection)?void 0===this.model&&void 0!==this.collection.prototype.model&&(this.model=this.collection.prototype.model):this.model=this.collection.model,void 0===this.model)throw Error("The model must be specified");if(void 0===this.views)throw Error("Views must be defined")},onMain:function(t){var e,i=this;return e=new this.views.main.view,e.on("new",function(){return i.trigger("action:route","create")}),e.on("edit",function(t){return i.trigger("action:route","edit",{id:t.get("id")},{model:t})}),e.on("delete",function(t){return i.trigger("action:noroute","delete",{model:t})}),t.updatedRegions[this.views.main.region]=o.view(e)},onCreate:function(t){var e,i=this;return e=new this.views.create.view,e.on("create",function(t){return i.collection.create(t),i.trigger("action:route","main")}),t.updatedRegions[this.views.create.region]=o.view(e)},onEdit:function(t){var e,i=this;return e=new this.views.edit.view({model:o.model(this.collection,t)}),e.on("edit",function(t){return e.model.save(t),i.trigger("action:route","main")}),t.updatedRegions[this.views.edit.region]=o.view(e)},onDelete:function(t){var e,i=this;return e=new this.views["delete"].view({model:o.model(this.collection,t)}),e.on("delete",function(t){return i.collection.remove(t),i.trigger("action:noroute","main")}),e.render()}}),u.FormView=Backbone.Marionette.ItemView.extend({events:{"click .create":"create","click .edit":"edit"},modelAttributes:function(){throw Error("Missing method getAttributes().")},create:function(t){return t.preventDefault(),this.trigger("create",this.modelAttributes())},edit:function(t){return t.preventDefault(),this.trigger("edit",this.modelAttributes())}}),u.DeleteView=Backbone.View.extend({triggerMethod:t.triggerMethod,events:{"click .no":"no","click .yes":"yes"},no:function(t){return t.preventDefault(),this.triggerMethod("no",t)},yes:function(t){return t.preventDefault(),this.triggerMethod("yes",t),this.trigger("delete",this.model)}}),u.MainRegion=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.el=".content",o}(t.Region),a={info:"datagrid.info",pager:{first:"datagrid.pager.first",last:"datagrid.pager.last",next:"datagrid.pager.next",previous:"datagrid.pager.previous",filler:"datagrid.pager.filler"}},u.setupDefaultI18nBindings=function(t){return a=o.defaults(t.i18n||{},a)},u.can=function(t,e){return s.can(t,e)},u.cannot=function(t,e){return s.cannot(t,e)},u}(Backbone,Backbone.Marionette,_,$||window.jQuery||window.Zepto||window.ender)}).call(this);